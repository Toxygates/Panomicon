<div>
  <h3>{{ addMode ? "Add" : "Edit"}} Batch</h3>

  <app-validated-input
    id="id"
    label="ID"
    [(value)]="batch.id"
    [disabled]="!addMode"
    [invalid]="!batch.id"
    invalidMessage="Please enter a batch ID"
  >
  </app-validated-input>

  <div class="form-group">
    <label for="datasetSelect">Dataset</label>
    <select
      class="form-control"
      id="datasetSelect"
      name="datasetSelect"
      [(ngModel)]="batch.dataset"
      [class.is-invalid]="!batch.dataset"
    >
      <option
        *ngFor="let dataset of (adminData.datasets$ | async); index as i"
        [ngValue]="dataset.id"
      >{{dataset.id}}</option>
    </select>
    <div class="invalid-feedback">
      Please select a dataset
    </div>
  </div>

  <div class="form-group">
    <label>Instances</label>
    <div class="form-check" *ngFor="let instance of (adminData.instances$ | async); index as i">
      <input
        class="form-check-input"
        type="checkbox"
        [checked]="batch.enabledInstances?.includes(instance.id)"
        (change)="toggleInstance(instance.id)"
        id="instance-{{instance.id}}"
      >
      <label class="form-check-label" for="instance-{{instance.id}}">
        {{instance.id}}
      </label>
    </div>
  </div>

  <app-validated-input
    id="description"
    label="Comment"
    [(value)]="batch.comment"
  >
  </app-validated-input>

  <app-validated-input
    id="publicComment"
    label="Public Comment"
    [(value)]="batch.publicComment"
  >
  </app-validated-input>

  <div class="form-group">
    <label for="file">Metadata file (TSV)</label>
    <input type="file"
      id="file"
      (change)="handleFileInput($event.target, 'metadata')"
      [class.is-invalid]="!files.get('metadata')"
    >
    <div class="invalid-feedback">
      Please select a metadata file
    </div>
  </div>

  <ng-container *ngIf="addMode">
    <div class="form-group">
      <label for="file">Expression file (CSV)</label>
      <input type="file"
        id="file"
        (change)="handleFileInput($event.target, 'exprData')"
        [class.is-invalid]="!files.get('exprData')"
      >
      <div class="invalid-feedback">
        Please select an expression file
      </div>
    </div>

    <div class="form-group">
      <label for="file">Calls file (CSV; optional)</label>
      <input type="file"
        id="file"
        (change)="handleFileInput($event.target, 'callsData')"
      >
    </div>

    <div class="form-group">
      <label for="file">Probes file (CSV; optional)</label>
      <input type="file"
        id="file"
        (change)="handleFileInput($event.target, 'probesData')"
      >
    </div>
  </ng-container>

  <div class="form-group" *ngIf="!addMode">
    <div class="form-check">
      <input
        class="form-check-input"
        type="checkbox"
        id="recalculate"
        [(ngModel)]="recalculate"
      >
      <label class="form-check-label" for="recalculate">
        Recalculate folds and series
      </label>
    </div>
  </div>

  <button type="button" class="btn btn-primary"
    (click)="submit(batch)">
    {{ addMode ? "Add" : "Save"}} batch
  </button>
  <span class="float-right">
    <a class="btn btn-danger" role="button" routerLink="/admin/batches"
    >Cancel</a>
  </span>
</div>
